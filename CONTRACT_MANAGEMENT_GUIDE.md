# 📋 دليل استخدام نظام إدارة التعاقدات

## 🎯 نظرة عامة
تم تطوير نظام شامل لإدارة التعاقدات يتيح:
- تحويل الحجوزات إلى تعاقدات مع تأكيد رقم الهوية
- عرض وإدارة جميع التعاقدات الحالية
- إلغاء التعاقدات وإرجاع السير الذاتية للحالة الجديدة

---

## 🔄 دورة حياة التعاقد

### 1. من الحجز إلى التعاقد
```
حجز جديد → تأكيد التعاقد → تعاقد نشط
```

**الخطوات:**
1. انتقل إلى صفحة **إدارة الحجوزات** (`/dashboard/bookings`)
2. اضغط على زر **"تعاقد"** للحجز المطلوب
3. سيظهر مودال تأكيد يحتوي على:
   - معلومات السيرة الذاتية (الاسم، الجنسية، الوظيفة، الكود المرجعي)
   - رقم الهوية (مملوء مسبقاً من الحجز مع إمكانية التعديل)
   - تحذيرات حول ما سيحدث عند التعاقد
4. راجع رقم الهوية وعدّله إذا لزم الأمر
5. اضغط **"تأكيد التعاقد"**

**ما يحدث عند التأكيد:**
- ✅ إنشاء سجل تعاقد جديد
- ✅ تحويل حالة السيرة الذاتية إلى "متعاقد"
- ✅ حذف الحجز الأصلي
- ✅ حذف أي حجوزات أخرى لنفس السيرة
- ✅ تسجيل النشاط في سجل الأنشطة

### 2. إدارة التعاقدات النشطة
```
تعاقد نشط → عرض التفاصيل → إلغاء (اختياري)
```

**الوصول للصفحة:**
- من الـ Sidebar: **حالات السير الذاتية** → **إدارة التعاقدات**
- أو مباشرة: `/dashboard/contracts-management`

**الميزات المتاحة:**
- 📋 عرض جميع التعاقدات مع التفاصيل الكاملة
- 🔍 بحث بالاسم، رقم الهوية، أو الكود المرجعي
- 👁️ عرض السيرة الذاتية في نافذة جديدة
- 🗑️ إلغاء التعاقد

### 3. إلغاء التعاقد
```
تعاقد نشط → طلب الإلغاء → تأكيد → سيرة ذاتية جديدة
```

**خطوات الإلغاء:**
1. في صفحة إدارة التعاقدات، اضغط **"إلغاء التعاقد"**
2. سيظهر مودال تأكيد يعرض:
   - تفاصيل التعاقد (الاسم، رقم الهوية، تاريخ التعاقد)
   - تحذيرات واضحة حول عواقب الإلغاء
3. اضغط **"تأكيد الإلغاء"** للمتابعة

**ما يحدث عند الإلغاء:**
- ❌ حذف سجل التعاقد نهائياً
- 🔄 إرجاع السيرة الذاتية إلى حالة "جديد"
- ✅ إتاحة السيرة للحجز والتعاقد مرة أخرى
- 📝 تسجيل عملية الإلغاء في سجل الأنشطة

---

## 🛠️ الميزات التقنية

### API Endpoints
- `GET /api/contracts` - جلب جميع التعاقدات
- `GET /api/contracts?cvId=123` - جلب تعاقدات سيرة ذاتية محددة
- `DELETE /api/contracts/[id]` - إلغاء تعاقد محدد
- `POST /api/bookings/[id]/contract` - تحويل حجز إلى تعاقد

### الأمان والموثوقية
- 🔐 **JWT Authentication**: جميع العمليات محمية
- 🔄 **Database Transactions**: ضمان تناسق البيانات
- 📝 **Activity Logging**: تسجيل جميع العمليات
- ✅ **Data Validation**: التحقق من صحة البيانات

### واجهة المستخدم
- 📱 **تصميم متجاوب**: يعمل على جميع الأجهزة
- 🎨 **ألوان متدرجة**: تصميم احترافي وجذاب
- 🔍 **بحث فوري**: نتائج سريعة أثناء الكتابة
- ⚡ **تحديث فوري**: تحديث القوائم بعد العمليات

---

## 📊 حالات الاستخدام

### حالة 1: تعاقد عادي
```
عميل يحجز سيرة ذاتية → المدير يراجع الحجز → يؤكد التعاقد برقم الهوية الصحيح
```

### حالة 2: تصحيح رقم الهوية
```
حجز برقم هوية خاطئ → المدير يعدل الرقم في مودال التعاقد → يؤكد التعاقد
```

### حالة 3: إلغاء تعاقد
```
تغيير في الظروف → المدير يلغي التعاقد → السيرة تعود متاحة للحجز
```

### حالة 4: البحث والمراجعة
```
المدير يبحث عن تعاقد معين → يراجع التفاصيل → يتخذ الإجراء المناسب
```

---

## ⚠️ تحذيرات مهمة

### عند التعاقد:
- ⚠️ **تأكد من رقم الهوية**: لا يمكن تعديله بعد التعاقد
- ⚠️ **الحجوزات الأخرى**: ستُحذف جميع حجوزات نفس السيرة
- ⚠️ **لا رجعة**: عملية التعاقد نهائية (إلا بالإلغاء الكامل)

### عند الإلغاء:
- ❌ **حذف نهائي**: لا يمكن استرجاع التعاقد المحذوف
- 🔄 **إعادة تعيين**: السيرة تعود لحالة "جديد" تماماً
- 📝 **التوثيق**: تأكد من توثيق سبب الإلغاء

---

## 🎯 أفضل الممارسات

### للمديرين:
1. **راجع دائماً** رقم الهوية قبل التأكيد
2. **تأكد من التفاصيل** قبل إلغاء أي تعاقد
3. **استخدم البحث** للعثور على التعاقدات بسرعة
4. **راجع سجل الأنشطة** لتتبع العمليات

### للنظام:
1. **نسخ احتياطية منتظمة** لقاعدة البيانات
2. **مراقبة الأداء** لضمان سرعة الاستجابة
3. **تحديث دوري** للأمان والميزات
4. **تدريب المستخدمين** على النظام الجديد

---

## 🆘 استكشاف الأخطاء

### مشاكل شائعة:

#### "فشل في إنشاء التعاقد"
- ✅ تأكد من صحة رقم الهوية
- ✅ تحقق من اتصال الإنترنت
- ✅ أعد تسجيل الدخول إذا لزم الأمر

#### "التعاقد غير موجود"
- ✅ تأكد من أن التعاقد لم يُلغَ مسبقاً
- ✅ حدّث الصفحة وحاول مرة أخرى
- ✅ تحقق من الصلاحيات

#### "فشل في تحميل التعاقدات"
- ✅ تحقق من اتصال الإنترنت
- ✅ أعد تحميل الصفحة
- ✅ تأكد من صحة تسجيل الدخول

---

## 📞 الدعم التقني

للمساعدة أو الإبلاغ عن مشاكل:
- 📧 راسل فريق التطوير
- 📝 قدم تفاصيل المشكلة والخطوات المتبعة
- 🖼️ أرفق لقطات شاشة إذا أمكن

---

## 🔄 التحديثات المستقبلية

### قيد التطوير:
- 📊 تقارير التعاقدات
- 📅 تذكيرات انتهاء التعاقدات
- 📱 إشعارات الهاتف المحمول
- 🔍 فلاتر متقدمة

### مخطط لها:
- 📄 طباعة عقود PDF
- 📈 إحصائيات مفصلة
- 🔄 تجديد التعاقدات
- 👥 إدارة متعددة المستخدمين

---

**تم إنشاء هذا الدليل في:** 29 سبتمبر 2024  
**الإصدار:** 1.0  
**النظام:** إدارة التعاقدات المتقدم
